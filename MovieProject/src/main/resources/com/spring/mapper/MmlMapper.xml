<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace="com.spring.mml.MmlDAO">
	
  
  ////////////////
  //유진 개발부분//
  ////////////////
  
  <resultMap type="com.spring.mml.Mml_ContentVO" id="mmlMap">
		<result property="mml_num" column="mml_num"/>
		<result property="mi_code" column="mi_code"/>
		<result property="id" column="id"/>
		<result property="mml_view_count" column="mml_view_count"/>
		<result property="mml_write_date" column="mml_write_date"/>
		<result property="mml_update_date" column="mml_update_date"/>
		<result property="mml_like" column="mml_like"/>
		<result property="mml_title" column="mml_title"/>
		<result property="mml_content" column="mml_content"/>
		<result property="mml_poster" column="mml_poster"/>
		<result property="mml_warn_count" column="mml_warn_count"/>
	</resultMap>
	
	<!-- mi_ccode왜 이름 코드야... 바꿔죵 -->
	<insert id="insertMml" parameterType="com.spring.mml.Mml_ContentVO">
		insert into mml_content values (seq_mml_num.nextval, 1, #{id}, 0, sysdate, sysdate, 
		0, #{mml_title, jdbcType=VARCHAR}, #{mml_content, jdbcType=VARCHAR}, 'test.jpeg', 0)
	</insert>
	
	<update id="updateMml" parameterType="com.spring.mml.Mml_ContentVO">
		UPDATE mml_content SET MI_CODE=2, MML_TITLE=#{mml_title, jdbcType=VARCHAR}, MML_CONTENT=#{mml_content, jdbcType=VARCHAR}, MML_POSTER='test2.jpg', MML_UPDATE_DATE=sysdate WHERE MML_NUM=#{mml_num}
	</update>
	
	<select id="getMmlContent" parameterType="int" resultMap="mmlMap">
		select * from mml_content where mml_num = #{mml_num}
	</select>
  
  ////////////////
  //웅식 개발부분//
  ////////////////
  
  
	<update id="upCounter">
	update mml_content
	set mml_view_count = mml_view_count +1
	where mml_num = #{mml_num}
	</update>
	
	<select id="getMmlContent" parameterType="INTEGER" resultType="com.spring.mml.Mml_ContentVO">
		select *
		from mml_content
		where mml_num = #{mml_num}
	</select>
	
	<select id="getMemberInfo" parameterType="INTEGER" resultType="com.spring.member.MemberVO">
		select *
		from member
		where id = #{id}
	</select>
	
	<select id="getCountFollower" resultType="INTEGER">
		select m_follower
		from member
		where id =#{id}
	</select>
	
	<select id="getCountLike" resultType="INTEGER">
		select mml_like
		from mml_content
		where mml_num =#{mml_num}
	</select>

<!--  =================================mml 팔로우 추가 매퍼 3종 -->		
	<insert id="registerFR">
		insert into member_follow
		values (1,#{mf_ing},#{mf_wer})
	
	</insert>

	<select id="FROverlapedChk"  resultType="INTEGER">
		select count(mf_code)
		from member_follow
		where mf_ing = #{mf_ing}
		and		mf_wer = #{mf_wer}
	
	</select>
	
	<update id="updateMml_follower" >
	update member 
	set m_follower = m_follower +1
	where id = #{id}
	</update>
<!--  ================================= mml 추천 추가 매퍼 3종 -->	
	<select id="giveLikeOverlapCheck"  resultType="INTEGER">
		select count(mct_like)
		from mml_content_thumb
		where  	id = #{giver}
		and		mml_num = #{mml_num}
	</select>

	
	<insert id="giveLike">
		insert into mml_content_thumb
		values (1,#{giver},#{mml_num})
	</insert>

	
	<update id="updateMml_like" >
	update mml_content
	set mml_like = mml_like +1
	where mml_num = #{mml_num}
	</update>
<!--  ================================= mml 신고 추가 매퍼 3종-->		
	<select id="giveWarningOverlapCheck"  resultType="INTEGER">
		select count(id)
		from mml_warning
		where  	id = #{giver}
		and		mml_num = #{mml_num}
	</select>

	
	<insert id="giveWarning">
		insert into mml_warning
		values (#{mml_num},#{giver}, sysdate)
	</insert>

	
	<update id="updateMml_warn_count" >
	update mml_content
	set mml_warn_count = mml_warn_count +1
	where mml_num = #{mml_num}
	</update>	
	
<!-- ==================================== mml 게시글 삭제 -->	

	<delete id="mmlDelete">
	delete mml_content
	where mml_num = #{mml_num}
	</delete>

<!-- ==================================== mml 게시글 삭제 -->	

	<select id="getFollowListFromMF_table" resultType="INTEGER">
	select mf_wer
	from member_follow
	where mf_ing = #{id}
	</select>	
	
<!-- ==================================== mml 게시글 삭제 -->	

	<select id="getFollowers" parameterType="list" resultType="com.spring.member.MemberVO">
	select *
	from member
	where id in 
		<foreach item="item" index="index" separator="," collection="list" open="(" close=")">
	#{item.value}
		</foreach>
	</select>
	
	
		
	
